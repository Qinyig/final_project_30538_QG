---
title: "CMS Open Payments Analysis"
subtitle: "30538 Final Project"
author: "Quinn Gan"
date: today
format: 
  html:
    code-fold: true
execute:
  echo: true
---

This project analyzes the CMS Open Payments dataset for the 2023 fiscal year. The Open Payments program is a national initiative to increase transparency in healthcare. It documents the financial relationships between drug manufacturers and healthcare providers. Our study examines the General Payments dataset on a national scale. 

Our analysis serves healthcare policy researchers, hospital administrators, or compliance teams who want to understand how industry payments to physicians are distributed and where potential concentration or conflict-of-interest risks may lie.

Our program pulls data directly from the CMS Metastore API. We use a programmatic loop to handle large amounts of data. This method ensures we capture a complete set of records for our analysis.


## 1. Distribution of Healthcare Payments by Specialty

To begin, I examine how industry payments are distributed across medical specialties in 2023. If financial relationships were evenly distributed, we would expect funding to be relatively similar across specialties. However, this figure reveals a highly concentrated pattern.

```{python}
#| label: specialty-analysis
import pandas as pd
import altair as alt

# Load the detailed payment dataset
df_details = pd.read_csv("data/derived-data/cms_payments_details.csv")

# Aggregate global totals per specialty for the ranking
spec_rank = df_details.groupby('specialty_clean')['payment_amount'].sum().nlargest(10).reset_index()

# Visualization: Horizontal Bar Chart for Rankings
spec_chart = alt.Chart(spec_rank).mark_bar().encode(
    x=alt.X('payment_amount:Q', title='Total Industry Payments (USD)', axis=alt.Axis(format='$.2s')),
    y=alt.Y('specialty_clean:N', sort='-x', title='Medical Specialty'),
    color=alt.Color('payment_amount:Q', scale=alt.Scale(scheme='blues'), legend=None),
    tooltip=['specialty_clean', alt.Tooltip('payment_amount:Q', format='$,.0f')]
).properties(
    title='Top 10 Medical Specialties by Industry Funding Intensity (2023)',
    width=600,
    height=300
)

spec_chart.display()
```

### Data Findings & Logical Decomposition

* **The Transparency Blind Spot: Dominance of "Unknown" Specialties**
* The visualization indicates that the "Unknown" category commands the highest share of funding, totaling nearly **$800 million**.
* In a policy context, this is not merely a statistical omission but a deep-seated phenomenon: it reveals that a massive volume of capital flows to individuals or entities without a registered clinical specialty in the CMS system.
* Synthesizing this with payment nature data, these payments are largely tied to high-value **Royalty or License** agreements for intellectual property, often paid to researchers or non-practicing physicians.
* This highlights that the industry’s most potent economic incentives are often shielded within the "upstream" segments of the transparency framework, where professional identities are less defined.


* **The Siphoning Effect of Technology-Intensive Specialties**
* Among identified clinical fields, **Orthopaedic Surgery** leads significantly with over **$400 million** in total funding.
* **High-Value Device Logic**: The high rankings of Orthopaedics and **Neurological Surgery** validate the hypothesis that industry funding is heavily concentrated in sectors reliant on expensive, high-tech medical devices.
* **Divergent Interaction Models**: A contrast emerges when comparing **Internal Medicine**, which ranks second in total value but boasts over **1.3 million individual payments**—nearly six times the frequency of Orthopaedics.
* This reveals two distinct industry strategies: "high-stakes technical bonding" for surgical specialties versus "high-frequency marketing coverage" for primary care and internal medicine.



```python
#| label: specialty-analysis
#| echo: false
```

### Core Conclusion: The Genesis of Structural Inequality

The results of this distribution analysis provide direct evidence regarding the concentration of resources:

1. **Extreme Resource Imbalance**: Industry sponsorship is not distributed based on patient volume or disease burden; instead, it is heavily skewed toward high-profit, device-driven disciplines.
2. **Conflict of Interest Hotspots**: The high funding intensity in Orthopaedics and Cardiovascular Disease implies that clinical guidelines and product selections in these fields face a much higher risk of Conflict of Interest (COI) than other disciplines.
3. **Preliminary Evidence of Inequality**: This financial chasm between specialties may create an internal economic hierarchy within the medical system, driven by varying levels of industrial support.



## 2. Proportional Distribution of Industry Payment Types

While the specialty distribution illustrates a horizontal concentration across different fields, it does not explain how these payments are structured. Specifically: What is the nature of these payments? Are they routine meal expenses spread across many, or multi-million dollar royalties monopolized by a few?

The subsequent **"Payment Type Distribution Analysis"** will decode the specific composition of these economic weights, further deconstructing the operational mechanisms of industry influence.

```{python}
#| label: payment-type-distribution
# 2. Data aggregation
type_dist = df_details.groupby('payment_type_clean')['payment_amount'].sum().reset_index()

# Visualization: Donut Chart
type_chart = alt.Chart(type_dist).mark_arc(innerRadius=60).encode(
    theta=alt.Theta(field="payment_amount", type="quantitative"),
    color=alt.Color(field="payment_type_clean", type="nominal", 
                    title="Payment Nature",
                    sort=alt.EncodingSortField(field="payment_amount", order='descending')),
    tooltip=[
        alt.Tooltip('payment_type_clean:N', title='Category'),
        alt.Tooltip('payment_amount:Q', format='$,.0f', title='Total Amount')
    ]
).properties(
    title='Proportional Distribution of Industry Payment Types (2023)',
    width=400,
    height=400
)

type_chart.display()


```

### Data Findings & Logical Decomposition

* **The Core of Economic Weight: Royalty & License**
* The donut chart reveals that **Royalty / License** fees command the largest share of total funding, amounting to approximately **$1.19 billion**.
* This confirms that the industry's primary economic incentives are not scattered daily subsidies but long-term financial interests deeply tied to intellectual property.
* Such massive payments are typically concentrated among a small number of highly influential researchers or institutions.


* **Deep Penetration into Professional Decision-Making: Consulting & Professional Services**
* **Non-consulting professional services** and **Consulting fees** represent the second-largest tier of funding.
* This reflects a strategic partnership where the industry hires physicians as speakers or consultants, integrating financial interests into academic dissemination and clinical decision-making processes.


* **Normalization of Routine Interaction: Food & Beverage**
* Although **Food & Beverage** payments account for a much smaller percentage of the total dollar amount, they occur with extreme frequency.
* This "high-frequency, low-value" interaction model represents a pervasive penetration into the daily lives of clinicians, aiming to build brand familiarity and maintain relationships through subtle, sustained influence.



```python
#| label: payment-type-distribution
#| echo: false

```

### Core Conclusion: Deep Economic Integration

The distribution of payment types addresses the vertical structure of industry influence:

1. **Asymmetry of Financial Ties**: A disproportionate amount of capital flows via royalties to a tiny elite, creating significant economic monopolies that may exacerbate resource inequality within the medical field.
2. **Risks to Professional Autonomy**: The prevalence of consulting and service fees increases the risk of professional judgment being influenced by financial interests, particularly in specialties where high-value payments are concentrated.
3. **Diversified Penetration Strategies**: Industry utilizes a dual strategy of "high-stakes economic bonding" and "high-frequency routine penetration" to shape the healthcare ecosystem comprehensively.


## 3. Wealth Alignment Analysis: Socio-economic Indicators and Industry Payments

Following the analysis of "horizontal concentration" by specialty and "vertical weight" by payment nature, this section explores whether these industrial funds are geographically tied to regional economic levels. By integrating socio-economic indicators from the **American Community Survey (ACS)**, we conduct a correlation test between state median household income and the intensity of industry funding received per household.

```{python}
#| label: socio-economic-correlation
# Load the state-level summary with economic indicators
df_state = pd.read_csv("data/derived-data/cms_acs_state_summary.csv")

# Visualization: Scatter Plot with Regression
scatter = alt.Chart(df_state).mark_circle(size=100, opacity=0.7).encode(
    x=alt.X('median_income:Q', 
            title='State Median Household Income (USD)', 
            scale=alt.Scale(zero=False)),
    y=alt.Y('payment_per_household:Q', 
            title='Industry Payment per Household (USD)'),
    color=alt.value('steelblue'),
    tooltip=['state_name', 
             alt.Tooltip('median_income:Q', format='$,.0f'), 
             alt.Tooltip('payment_per_household:Q', format='$.2f')]
).properties(
    title='Correlation: State Household Wealth vs. Healthcare Industry Payments',
    width=600,
    height=400
)

# Add a linear regression line to visualize the trend
final_plot = scatter + scatter.transform_regression('median_income', 'payment_per_household').mark_line(color='red')

final_plot.display()
```

### Data Findings & Logical Decomposition

* **Significant Positive Correlation Trend**
* The scatter plot and the fitted regression line demonstrate a clear positive relationship between **State Median Household Income** and **Industry Payment per Household**.
* This finding validates a market-driven logic: industry capital is not primarily directed toward economically disadvantaged areas to fill basic healthcare gaps; instead, it tends to gravitate toward the healthcare ecosystems of wealthier regions. This likely reflects the higher purchasing power, more advanced medical facilities, and broader private insurance coverage in high-income areas, which in turn attracts greater industry intervention.


* **Extreme Outliers in High-Income States**
* Notably, in the high-income bracket where median income exceeds **$70,000**, several significant outliers appear far above the regression line.
* **Policy Interpretation**: These outliers typically represent states housing top-tier research and teaching hospitals, high-tech biomedical clusters, or holders of high-value specific patents (e.g., California or Massachusetts). In these regions, industry funding has evolved beyond routine marketing into deep capital and technological integration.



```python
#| label: wealth-correlation-analysis
#| echo: false

```

### Core Conclusion: Shaping the Distribution of Influence via Economic Environments

This correlation analysis directly addresses research questions regarding social equity:

1. **Wealth Alignment Effect**: Industry payments exhibit a distinct "preference for prosperity" in their geographic distribution. The synchronous growth of funding with regional wealth levels suggests that industry prioritize market potential and return on investment when allocating resources.
2. **Exacerbation of Resource Concentration**: High-income states not only possess richer public resources but also receive a disproportionate share of industrial funding. This "icing on the cake" model may further widen the healthcare resource gap between states.
3. **Geographic Roots of Inequality**: If the geographic distribution of industry influence remains tethered to wealth, physicians and patients in low-income areas may face a relative disadvantage in accessing medical innovation and professional educational resources.


## 4. Geographic Distribution and Spatial Imbalance

While the wealth alignment analysis establishes a statistical link between income and funding, a **geographic visualization** is essential to identify specific "hotspots" of industry influence across the United States. This map normalizes total payments by the number of households in each state, providing a measure of **payment intensity** that allows for direct cross-state comparisons.
```{python}
#| label: national-map
from vega_datasets import data

# Load US states topojson
states_topo = alt.topo_feature(data.us_10m.url, 'states')

# Map state abbreviations to numeric IDs for Altair mapping
# (This ensures your 'state' column matches the Map IDs)
state_id_map = {
    'AL': 1, 'AK': 2, 'AZ': 4, 'AR': 5, 'CA': 6, 'CO': 8, 'CT': 9, 'DE': 10, 'FL': 12, 'GA': 13,
    'HI': 15, 'ID': 16, 'IL': 17, 'IN': 18, 'IA': 19, 'KS': 20, 'KY': 21, 'LA': 22, 'ME': 23,
    'MD': 24, 'MA': 25, 'MI': 26, 'MN': 27, 'MS': 28, 'MO': 29, 'MT': 30, 'NE': 31, 'NV': 32,
    'NH': 33, 'NJ': 34, 'NM': 35, 'NY': 36, 'NC': 37, 'ND': 38, 'OH': 39, 'OK': 40, 'OR': 41,
    'PA': 42, 'RI': 44, 'SC': 45, 'SD': 46, 'TN': 47, 'TX': 48, 'UT': 49, 'VT': 50, 'VA': 51,
    'WA': 53, 'WV': 54, 'WI': 55, 'WY': 56
}
df_state['id'] = df_state['state'].map(state_id_map)

# Visualization: Interactive Choropleth Map
map_chart = alt.Chart(states_topo).mark_geoshape().encode(
    color=alt.Color('payment_per_household:Q', 
                    title='Payment/Household ($)', 
                    scale=alt.Scale(scheme='tealblues')),
    tooltip=[
        alt.Tooltip('state_name:N', title='State'),
        alt.Tooltip('payment_per_household:Q', title='Payment Density', format='$.2f'),
        alt.Tooltip('median_income:Q', title='Median Income', format='$,.0f')
    ]
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(df_state, 'id', ['payment_per_household', 'state_name', 'median_income'])
).project(
    type='albersUsa'
).properties(
    title='Geographic Density of Industry Payments Across the US (2023)',
    width=700,
    height=400
)

map_chart.display()
```

### Data Findings & Logical Decomposition

* **Regional Concentration and "Hotspots"**
* The choropleth map reveals that industry payments are not uniformly distributed but are heavily clustered in specific Northeastern and Mid-Atlantic states.
* **Pennsylvania** and **Massachusetts** emerge as the most prominent outliers, exhibiting the highest payment density per household (exceeding $80 per household in some areas). This concentration likely reflects the presence of major pharmaceutical hubs and elite academic medical centers in these regions.


* **The Geographic "Tethering" Effect**
* The map confirms that high-intensity zones are largely contiguous with the high-income states identified in the previous scatter plot.
* Conversely, much of the **Midwest** and **Mountain West** display significantly lower payment densities (often below $20 per household). This spatial disparity suggests that industry engagement follows established economic and institutional infrastructures rather than being driven by a decentralized healthcare need.


* **Implications of Spatial Clustering**
* The extreme density in a few states indicates that a disproportionate share of industry-funded professional education, innovation, and consulting is sequestered in specific geographic corridors. This creates a "resource island" effect where clinicians in a handful of states have vastly more frequent interactions with industry resources than those in the rest of the country.


```python
#| label: geographic-map-analysis
#| echo: false

```

### Core Conclusion: Spatial Inequity in Industry Engagement

The geographic analysis provides the final piece of evidence for the project's central thesis:

1. **Geographic Consolidation**: Industry influence is highly localized. The concentration of funds in specific states suggests that the "mitigating effect" of transparency under the Sunshine Act faces a geographic challenge: influence is concentrated where clinical and economic power is already greatest.
2. **Access Disparities**: Clinicians and patients in low-density states may have less exposure to the newest (industry-funded) medical developments, while those in high-density states face much higher risks of systemic conflicts of interest.
3. **Policy Need for Targeted Oversight**: Federal oversight may need to be supplemented by state-level transparency initiatives in "high-intensity" zones to address the unique pressures created by such extreme spatial concentration.

## 5. Evidence of Extreme Financial Concentration

In addition to the structural and geographic imbalances previously discussed, a longitudinal assessment of the recipient pool reveals a profound level of economic inequality. This section utilizes a **Concentration Curve** (similar to a Lorenz Curve) to demonstrate the disproportionate share of industry funding held by a minute fraction of medical professionals.

```{python}
#| label: concentration-analysis
con_df = pd.read_csv("data/derived-data/concentration_data.csv")

# Key takeaway: What percentage of the money did the top 1% of people take?
top_1_percent_val = con_df[con_df['cum_percent_people'] <= 0.01]['cum_percent_money'].max()

# Drawing a portion of the Lorenz Curve
chart = alt.Chart(con_df.head(5000)).mark_line(color='#e63946', strokeWidth=3).encode(
    x=alt.X('cum_percent_people:Q', title='Cumulative Share of Recipients', axis=alt.Axis(format='%')),
    y=alt.Y('cum_percent_money:Q', title='Cumulative Share of Total Payments', axis=alt.Axis(format='%')),
    tooltip=['cum_percent_people', 'cum_percent_money']
).properties(
    title=f"Extreme Concentration: Top 1% Recipients capture approx. {top_1_percent_val:.1%} of Total Funds",
    width=600,
    height=400
)

# Add a 45-degree line of absolute fairness for comparison
line = alt.Chart(pd.DataFrame({'x': [0, 1], 'y': [0, 1]})).mark_line(strokeDash=[5,5], color='gray').encode(
    x='x', y='y'
)

(line + chart).display()
```

### Data Findings & Logical Decomposition

* **The "Hyper-Concentrated" Elite**:
* The visualization indicates that the **top 1% of recipients** capture approximately **66.0% of the total industry funds**. This reveals that the vast majority of the multibillion-dollar pool is not distributed broadly for routine medical education or small-scale consulting but is instead sequestered by a tiny financial elite.
* This "Pareto-style" distribution suggests that for most physicians, industry interaction is high-frequency but low-value (e.g., meals), while for the top 1%, it is a primary economic driver involving millions of dollars in individual payments.


* **Departure from Equality**:
* The dashed diagonal line represents a hypothetical scenario of perfect equality (where 1% of people get 1% of the money).
* The sharp, nearly vertical trajectory of the red line at the start of the x-axis illustrates the extreme "winner-take-all" nature of industry-physician financial relationships in 2023.



```python
#| label: concentration-analysis
#| echo: false

```

### Core Conclusion: The Monopoly of Influence

The concentration analysis provides the final and perhaps most compelling evidence regarding healthcare inequality:

1. **Systemic Financial Oligarchy**: A small number of high-profile physicians—often those involved in major intellectual property or key opinion leadership (KOL) roles—wield disproportionate economic influence over the medical field.
2. **Dilution of Transparency Intent**: While the Sunshine Act makes all payments transparent, the sheer volume of data can obscure the fact that the "average" physician's financial tie is negligible compared to the massive economic interests concentrated at the top 1%.
3. **Policy Implication for Equity**: Oversight efforts should not be equally distributed; instead, policy focus and conflict-of-interest auditing should be prioritized for this top 1% of recipients who control over two-thirds of the total funding, as their decisions have the highest potential for systemic impact.

